<!-- Login Modal -->
<app-login-modal
  [isOpen]="showLoginModal()"
  [username]="guestUsername()"
  (usernameChange)="onLoginModalUsernameChange($event)"
  (login)="onLoginModalLogin()"
  (generateRandom)="onLoginModalGenerateRandom()"
  (close)="showLoginModal.set(false)">
</app-login-modal>

<div class="flex flex-col h-[calc(100vh-100px)] max-h-[800px] w-full max-w-4xl mx-auto bg-white/10 backdrop-blur-2xl border border-white/20 rounded-3xl shadow-2xl overflow-hidden animate-[float_8s_ease-in-out_infinite]">
  <!-- Header -->
  <div class="p-4 border-b border-white/20 bg-gradient-to-r from-purple-500/20 via-pink-500/20 to-blue-500/20">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <h1 class="text-2xl font-bold bg-gradient-to-r from-purple-300 via-pink-300 to-blue-300 bg-clip-text text-transparent animate-[pulse-glow_3s_ease-in-out_infinite]">ğŸ’¬ SparkChat</h1>
        <div class="flex items-center gap-2 text-white/70 text-sm">
          <span class="w-2 h-2 bg-green-400 rounded-full animate-[pulse-glow_2s_ease-in-out_infinite] shadow-[0_0_10px_rgba(34,197,94,0.6)]"></span>
          <span class="font-medium">{{ onlineUsers().length }} {{ 'chat.online' | translate }}</span>
        </div>
      </div>
      <div class="flex items-center gap-3">
        <!-- Language Toggle -->
        <button
          (click)="toggleLanguage()"
          class="w-10 h-10 p-2 rounded-full bg-white/10 hover:bg-white/20 text-white text-lg transition-all duration-300 border border-white/20 cursor-pointer hover:scale-110 hover:rotate-6 flex items-center justify-center"
          [title]="getCurrentLang() === 'km' ? 'Switch to English' : 'á”áŸ’áá¼ášá‘áŸ…á—á¶áŸá¶ááŸ’á˜áŸ‚áš'">
          {{ getCurrentLang() === 'km' ? 'ğŸ‡°ğŸ‡­' : 'ğŸ‡¬ğŸ‡§' }}
        </button>
        @if (isLoggedIn()) {
          <div class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/10 border border-white/20">
            <span class="text-sm font-medium text-white/90">{{ currentUser() }}</span>
            <button
              (click)="logout()"
              class="text-xs text-white/70 hover:text-white transition-colors"
              title="Logout">
              ğŸšª
            </button>
          </div>
        }
        <div class="flex gap-2">
          <button 
            (click)="toggleSettings()"
            class="w-10 h-10 p-2 rounded-full bg-white/10 hover:bg-white/20 text-white text-lg transition-all duration-300 border border-white/20 cursor-pointer hover:scale-110 hover:rotate-6 flex items-center justify-center">âš™ï¸</button>
          <button 
            (click)="toggleSearch()"
            class="w-10 h-10 p-2 rounded-full bg-white/10 hover:bg-white/20 text-white text-lg transition-all duration-300 border border-white/20 cursor-pointer hover:scale-110 hover:rotate-6 flex items-center justify-center">ğŸ”</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Messages Area -->
  <div class="flex-1 overflow-y-auto p-4 space-y-4 scrollbar-thin scrollbar-thumb-white/20 scrollbar-track-transparent">
    <div class="flex flex-col gap-3">
      @for (message of messages(); track message.id) {
        <app-message-item [message]="message" [currentUsername]="currentUser()"></app-message-item>
      }
    </div>
  </div>

  <!-- Chat Input -->
  <app-chat-input
    [message]="newMessage()"
    [previewGifUrl]="previewGifUrl()"
    [isLoggedIn]="isLoggedIn()"
    (messageChange)="newMessage.set($event)"
    (emojiSelected)="onEmojiSelected($event)"
    (gifSelected)="onGifSelected($event)"
    (sendMessage)="sendMessage()"
    (removeGifPreview)="removeGifPreview()">
  </app-chat-input>

  <!-- Search Modal -->
  <app-search-modal
    [isOpen]="showSearch()"
    [searchQuery]="searchQuery()"
    [searchResults]="searchResults()"
    (searchQueryChange)="onSearchModalQueryChange($event)"
    (navigateToMessage)="onSearchModalNavigate($event)"
    (close)="toggleSearch()">
  </app-search-modal>

  <!-- Settings Modal -->
  <app-settings-modal
    [isOpen]="showSettings()"
    [chatService]="chatService"
    [musicService]="musicService"
    (toggleSound)="toggleSound()"
    (toggleNotifications)="toggleNotifications()"
    (toggleTheme)="toggleTheme()"
    (toggleMusic)="toggleMusic()"
    (musicVolumeChange)="setMusicVolume($event)"
    (close)="toggleSettings()">
  </app-settings-modal>
</div>
